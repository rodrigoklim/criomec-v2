on:
  push:
    branches:
      - dev

name: ðŸš€ Deploy Homolog

jobs:
  web-deploy:
    name: ðŸŽ‰ Deploy
    runs-on: ubuntu-latest
    steps:
      -
        name: ðŸšš Get latest code
        uses: actions/checkout@v4

      -
        name: ðŸ“‚ Backup Current Files
        uses: appleboy/ssh-action@v0.1.10
        with:
          host: ${{ secrets.SSH_HOST }}
          username: ${{ secrets.SSH_USERNAME }}
          key: ${{ secrets.SSH_KEY }}
          use_insecure_cipher: true
          cipher: aes256-cbc
          script: |
            TIMESTAMP=$(date +"%Y%m%d_%H%M%S")
            BACKUP_DIR="/homolog.cadapp/versions/${TIMESTAMP}"

            echo "âš¡ Creating backup of current deployment..."
            mkdir -p $BACKUP_DIR
            cp -r /homolog.cadapp.com.br/* $BACKUP_DIR/

            echo "âœ… Backup created at: $BACKUP_DIR"
